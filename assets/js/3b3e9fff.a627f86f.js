"use strict";(globalThis.webpackChunkbook_ui=globalThis.webpackChunkbook_ui||[]).push([[241],{3056:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>p,frontMatter:()=>a,metadata:()=>r,toc:()=>h});const r=JSON.parse('{"id":"chapter-2/ros2-fundamentals","title":"Chapter 2: The Robotic Nervous System (ROS 2)","description":"Overview","source":"@site/docs/chapter-2/ros2-fundamentals.mdx","sourceDirName":"chapter-2","slug":"/chapter-2/ros2-fundamentals","permalink":"/ai-spec-hackathone/docs/chapter-2/ros2-fundamentals","draft":false,"unlisted":false,"editUrl":"https://github.com/rabiasohail098/ai-spec-hackathone/tree/main/docs/chapter-2/ros2-fundamentals.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Chapter 2: The Robotic Nervous System (ROS 2)","sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Chapter 1: Introduction to Physical AI and Embodied Intelligence","permalink":"/ai-spec-hackathone/docs/chapter-1/introduction-to-physical-ai"},"next":{"title":"Chapter 3: The Digital Twin (Gazebo & Unity)","permalink":"/ai-spec-hackathone/docs/chapter-3/digital-twin-simulation"}}');var s=i(4848),t=i(8453),o=(i(9815),i(7561)),l=i(3113);const a={title:"Chapter 2: The Robotic Nervous System (ROS 2)",sidebar_position:2},c="Chapter 2: The Robotic Nervous System (ROS 2)",d={},h=[{value:"Overview",id:"overview",level:2},{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"The ROS 2 Ecosystem: A Robotic Nervous System",id:"the-ros-2-ecosystem-a-robotic-nervous-system",level:2},{value:"Understanding the Need for Middleware",id:"understanding-the-need-for-middleware",level:3},{value:"The ROS 2 Architecture",id:"the-ros-2-architecture",level:3},{value:"Core Concepts of ROS 2",id:"core-concepts-of-ros-2",level:2},{value:"1. Nodes",id:"1-nodes",level:3},{value:"2. Topics (Publish/Subscribe)",id:"2-topics-publishsubscribe",level:3},{value:"3. Services (Request/Response)",id:"3-services-requestresponse",level:3},{value:"4. Actions",id:"4-actions",level:3},{value:"Building ROS 2 Packages with Python",id:"building-ros-2-packages-with-python",level:2},{value:"Package Structure",id:"package-structure",level:3},{value:"Creating a Basic ROS 2 Package",id:"creating-a-basic-ros-2-package",level:3},{value:"Python Package Structure Example",id:"python-package-structure-example",level:3},{value:"Launch Files and Parameter Management",id:"launch-files-and-parameter-management",level:2},{value:"Launch Files",id:"launch-files",level:3},{value:"Parameter Files",id:"parameter-files",level:3},{value:"Bridging AI Agents to ROS Controllers with rclpy",id:"bridging-ai-agents-to-ros-controllers-with-rclpy",level:2},{value:"Integrating AI Models with ROS 2",id:"integrating-ai-models-with-ros-2",level:3},{value:"Understanding URDF (Unified Robot Description Format)",id:"understanding-urdf-unified-robot-description-format",level:2},{value:"Quality of Service (QoS) Profiles",id:"quality-of-service-qos-profiles",level:2},{value:"Visualization and Debugging Tools",id:"visualization-and-debugging-tools",level:2},{value:"RViz2",id:"rviz2",level:3},{value:"rqt",id:"rqt",level:3},{value:"Security in ROS 2",id:"security-in-ros-2",level:2},{value:"Best Practices for ROS 2 Development",id:"best-practices-for-ros-2-development",level:2},{value:"1. Node Design",id:"1-node-design",level:3},{value:"2. Message Design",id:"2-message-design",level:3},{value:"3. Performance Optimization",id:"3-performance-optimization",level:3},{value:"Chapter Summary",id:"chapter-summary",level:2},{value:"Key Terms",id:"key-terms",level:2},{value:"Practice Questions",id:"practice-questions",level:2},{value:"Reflection Questions",id:"reflection-questions",level:2}];function u(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"chapter-2-the-robotic-nervous-system-ros-2",children:"Chapter 2: The Robotic Nervous System (ROS 2)"})}),"\n",(0,s.jsx)(o.A,{chapterId:"chapter-2"}),"\n",(0,s.jsx)(l.A,{chapterId:"chapter-2"}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"The Robot Operating System 2 (ROS 2) serves as the central nervous system for modern robotic platforms, providing the middleware infrastructure that enables seamless communication, coordination, and control across diverse robotic components. In this chapter, we'll explore the fundamental concepts of ROS 2 architecture, examine its core components, and understand how it bridges AI agents with physical robot controllers. This knowledge forms the foundation for developing sophisticated Physical AI systems that require reliable, real-time communication between perception, planning, and control modules."}),"\n",(0,s.jsx)(n.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,s.jsx)(n.p,{children:"By the end of this chapter, you will:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Understand the architecture and core concepts of ROS 2"}),"\n",(0,s.jsx)(n.li,{children:"Identify and implement ROS 2 communication patterns (Nodes, Topics, Services, Actions)"}),"\n",(0,s.jsx)(n.li,{children:"Develop ROS 2 packages using Python with rclpy"}),"\n",(0,s.jsx)(n.li,{children:"Create launch files and manage parameters effectively"}),"\n",(0,s.jsx)(n.li,{children:"Bridge AI agents to ROS 2 controllers using rclpy"}),"\n",(0,s.jsx)(n.li,{children:"Understand URDF (Unified Robot Description Format) and its role in humanoid robotics"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"the-ros-2-ecosystem-a-robotic-nervous-system",children:"The ROS 2 Ecosystem: A Robotic Nervous System"}),"\n",(0,s.jsx)(n.h3,{id:"understanding-the-need-for-middleware",children:"Understanding the Need for Middleware"}),"\n",(0,s.jsx)(n.p,{children:"Robots are inherently complex systems comprising multiple components: sensors, actuators, perception systems, planning algorithms, control mechanisms, and user interfaces. Without a robust communication framework, coordinating these components would require complex ad-hoc connections, leading to tightly coupled, inflexible, and difficult-to-maintain systems."}),"\n",(0,s.jsx)(n.p,{children:"ROS 2 addresses this challenge by providing:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Decoupled Architecture"}),": Components can be developed, tested, and maintained independently"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Message-Based Communication"}),": Standardized communication protocols for diverse components"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Real-time Capabilities"}),": Deterministic behavior for time-critical control tasks"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Security"}),": Enhanced security features for deployed robotic systems"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Multi-robot Support"}),": Coordination of multiple robots in shared environments"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"the-ros-2-architecture",children:"The ROS 2 Architecture"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"                    ROS 2 Ecosystem\n         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n         \u2502         ROS 2 Nodes             \u2502\n         \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n         \u2502  \u2502Perception\u2502  \u2502Planning  \u2502     \u2502\n         \u2502  \u2502Node     \u2502  \u2502Node      \u2502     \u2502\n         \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n         \u2502        \u2502            \u2502          \u2502\n         \u2502        \u25bc            \u25bc          \u2502\n         \u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n         \u2502    \u2502   ROS 2 Communication   \u2502  \u2502\n         \u2502    \u2502       Framework         \u2502  \u2502\n         \u2502    \u2502  (Topics, Services,     \u2502  \u2502\n         \u2502    \u2502   Actions, Parameters)  \u2502  \u2502\n         \u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n         \u2502        \u2502            \u2502          \u2502\n         \u2502        \u25bc            \u25bc          \u2502\n         \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n         \u2502  \u2502Control  \u2502  \u2502Hardware  \u2502     \u2502\n         \u2502  \u2502Node     \u2502  \u2502Interface \u2502     \u2502\n         \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(n.h2,{id:"core-concepts-of-ros-2",children:"Core Concepts of ROS 2"}),"\n",(0,s.jsx)(n.h3,{id:"1-nodes",children:"1. Nodes"}),"\n",(0,s.jsx)(n.p,{children:"Nodes are the fundamental building blocks of ROS 2, representing individual processes that perform computations. Each node is typically responsible for a specific function:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# Example ROS 2 Node Structure\nimport rclpy\nfrom rclpy.node import Node\n\nclass PerceptionNode(Node):\n    def __init__(self):\n        super().__init__('perception_node')\n        self.get_logger().info('Perception Node Started')\n        \n    def process_sensor_data(self, sensor_msg):\n        # Process the sensor data\n        pass\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Characteristics of Nodes:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Each node runs as a separate process"}),"\n",(0,s.jsx)(n.li,{children:"Nodes communicate with each other through topics, services, or actions"}),"\n",(0,s.jsx)(n.li,{children:"Nodes can be written in different programming languages (C++, Python, etc.)"}),"\n",(0,s.jsx)(n.li,{children:"Nodes can be run on different machines in a distributed system"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"2-topics-publishsubscribe",children:"2. Topics (Publish/Subscribe)"}),"\n",(0,s.jsx)(n.p,{children:"Topics enable asynchronous, one-to-many communication:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# Publisher Example\nimport rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String\n\nclass DataPublisher(Node):\n    def __init__(self):\n        super().__init__('data_publisher')\n        self.publisher = self.create_publisher(String, 'sensor_data', 10)\n        timer_period = 0.5  # seconds\n        self.timer = self.create_timer(timer_period, self.timer_callback)\n    \n    def timer_callback(self):\n        msg = String()\n        msg.data = 'Hello Robot World'\n        self.publisher.publish(msg)\n        self.get_logger().info('Publishing: \"%s\"' % msg.data)\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# Subscriber Example\nimport rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String\n\nclass DataSubscriber(Node):\n    def __init__(self):\n        super().__init__('data_subscriber')\n        self.subscription = self.create_subscription(\n            String,\n            'sensor_data',\n            self.listener_callback,\n            10)\n        self.subscription  # prevent unused variable warning\n\n    def listener_callback(self, msg):\n        self.get_logger().info('I heard: \"%s\"' % msg.data)\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Topic Characteristics:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Asynchronous communication"}),"\n",(0,s.jsx)(n.li,{children:"One-to-many: publishers can send to multiple subscribers"}),"\n",(0,s.jsx)(n.li,{children:'Data is "fire and forget" - no acknowledgment'}),"\n",(0,s.jsx)(n.li,{children:"Uses Quality of Service (QoS) profiles for reliability and performance tuning"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"3-services-requestresponse",children:"3. Services (Request/Response)"}),"\n",(0,s.jsx)(n.p,{children:"Services enable synchronous, one-to-one communication:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# Service Server\nimport rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import AddTwoInts\n\nclass MinimalService(Node):\n    def __init__(self):\n        super().__init__('minimal_service')\n        self.srv = self.create_service(AddTwoInts, 'add_two_ints', self.add_two_ints_callback)\n\n    def add_two_ints_callback(self, request, response):\n        response.sum = request.a + request.b\n        self.get_logger().info('Incoming request\\na: %d b: %d' % (request.a, request.b))\n        return response\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# Service Client\nimport rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import AddTwoInts\n\nclass MinimalClient(Node):\n    def __init__(self):\n        super().__init__('minimal_client')\n        self.cli = self.create_client(AddTwoInts, 'add_two_ints')\n        while not self.cli.wait_for_service(timeout_sec=1.0):\n            self.get_logger().info('Service not available, waiting again...')\n        self.req = AddTwoInts.Request()\n\n    def send_request(self, a, b):\n        self.req.a = a\n        self.req.b = b\n        self.future = self.cli.call_async(self.req)\n        rclpy.spin_until_future_complete(self, self.future)\n        return self.future.result()\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Service Characteristics:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Synchronous communication"}),"\n",(0,s.jsx)(n.li,{children:"Request/Response pattern"}),"\n",(0,s.jsx)(n.li,{children:"One-to-one communication"}),"\n",(0,s.jsx)(n.li,{children:"Blocks until response is received"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"4-actions",children:"4. Actions"}),"\n",(0,s.jsx)(n.p,{children:"Actions enable asynchronous, goal-oriented communication with feedback:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# Action Server\nimport rclpy\nfrom rclpy.action import ActionServer\nfrom rclpy.node import Node\nfrom example_interfaces.action import Fibonacci\n\nclass FibonacciActionServer(Node):\n    def __init__(self):\n        super().__init__('fibonacci_action_server')\n        self._action_server = ActionServer(\n            self,\n            Fibonacci,\n            'fibonacci',\n            self.execute_callback)\n\n    def execute_callback(self, goal_handle):\n        self.get_logger().info('Executing goal...')\n        \n        feedback_msg = Fibonacci.Feedback()\n        feedback_msg.sequence = [0, 1]\n        \n        for i in range(1, goal_handle.request.order):\n            if goal_handle.is_cancel_requested:\n                goal_handle.canceled()\n                self.get_logger().info('Goal canceled')\n                return Fibonacci.Result()\n            \n            feedback_msg.sequence.append(\n                feedback_msg.sequence[i] + feedback_msg.sequence[i-1])\n            \n            goal_handle.publish_feedback(feedback_msg)\n            time.sleep(1)\n        \n        goal_handle.succeed()\n        result = Fibonacci.Result()\n        result.sequence = feedback_msg.sequence\n        self.get_logger().info('Returning result: {0}'.format(result.sequence))\n        \n        return result\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Action Characteristics:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Long-running operations with feedback"}),"\n",(0,s.jsx)(n.li,{children:"Goal/Cancel/Result pattern"}),"\n",(0,s.jsx)(n.li,{children:"Asynchronous execution"}),"\n",(0,s.jsx)(n.li,{children:"Progress monitoring capability"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"building-ros-2-packages-with-python",children:"Building ROS 2 Packages with Python"}),"\n",(0,s.jsx)(n.h3,{id:"package-structure",children:"Package Structure"}),"\n",(0,s.jsx)(n.p,{children:"A ROS 2 package typically follows this structure:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"my_robot_package/\n\u251c\u2500\u2500 CMakeLists.txt         # Build configuration (for C++)\n\u251c\u2500\u2500 package.xml           # Package metadata\n\u251c\u2500\u2500 setup.py             # Python build configuration\n\u251c\u2500\u2500 setup.cfg            # Installation configuration\n\u251c\u2500\u2500 resource/            # Resources for the package\n\u251c\u2500\u2500 test/                # Unit tests\n\u251c\u2500\u2500 launch/              # Launch files\n\u251c\u2500\u2500 config/              # Configuration files\n\u2514\u2500\u2500 my_robot_package/    # Python source code\n    \u251c\u2500\u2500 __init__.py\n    \u251c\u2500\u2500 robot_controller.py\n    \u2514\u2500\u2500 perception_node.py\n"})}),"\n",(0,s.jsx)(n.h3,{id:"creating-a-basic-ros-2-package",children:"Creating a Basic ROS 2 Package"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Create a new ROS 2 package\nros2 pkg create --build-type ament_python my_robot_package --dependencies rclpy std_msgs geometry_msgs sensor_msgs\n"})}),"\n",(0,s.jsx)(n.h3,{id:"python-package-structure-example",children:"Python Package Structure Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# my_robot_package/robot_controller.py\nimport rclpy\nfrom rclpy.node import Node\nfrom geometry_msgs.msg import Twist\nfrom sensor_msgs.msg import LaserScan\n\nclass RobotController(Node):\n    def __init__(self):\n        super().__init__('robot_controller')\n        \n        # Create publisher for robot velocity commands\n        self.cmd_vel_publisher = self.create_publisher(\n            Twist, \n            'cmd_vel', \n            10\n        )\n        \n        # Create subscriber for laser scan data\n        self.laser_subscriber = self.create_subscription(\n            LaserScan,\n            'scan',\n            self.laser_callback,\n            10\n        )\n        \n        # Create timer for control loop\n        self.timer = self.create_timer(0.1, self.control_loop)\n        \n        self.get_logger().info('Robot Controller initialized')\n\n    def laser_callback(self, msg):\n        # Process laser scan data\n        self.get_logger().info(f'Laser range: {msg.ranges[0]:.2f} meters')\n\n    def control_loop(self):\n        # Implement control logic\n        cmd = Twist()\n        cmd.linear.x = 0.5  # Move forward at 0.5 m/s\n        cmd.angular.z = 0.0  # No rotation\n        self.cmd_vel_publisher.publish(cmd)\n\ndef main(args=None):\n    rclpy.init(args=args)\n    robot_controller = RobotController()\n    rclpy.spin(robot_controller)\n    robot_controller.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,s.jsx)(n.h2,{id:"launch-files-and-parameter-management",children:"Launch Files and Parameter Management"}),"\n",(0,s.jsx)(n.h3,{id:"launch-files",children:"Launch Files"}),"\n",(0,s.jsx)(n.p,{children:"Launch files allow you to start multiple nodes with a single command:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# launch/robot_system.launch.py\nfrom launch import LaunchDescription\nfrom launch_ros.actions import Node\nfrom ament_index_python.packages import get_package_share_directory\nimport os\n\ndef generate_launch_description():\n    return LaunchDescription([\n        Node(\n            package='my_robot_package',\n            executable='robot_controller',\n            name='robot_controller',\n            parameters=[\n                os.path.join(get_package_share_directory('my_robot_package'), 'config', 'robot_params.yaml')\n            ],\n            output='screen'\n        ),\n        Node(\n            package='my_robot_package',\n            executable='perception_node',\n            name='perception_node',\n            output='screen'\n        )\n    ])\n"})}),"\n",(0,s.jsx)(n.h3,{id:"parameter-files",children:"Parameter Files"}),"\n",(0,s.jsx)(n.p,{children:"Parameters are typically stored in YAML files:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# config/robot_params.yaml\nrobot_controller:\n  ros__parameters:\n    max_linear_velocity: 1.0\n    max_angular_velocity: 1.0\n    safety_distance: 0.5\n    control_frequency: 10.0\n"})}),"\n",(0,s.jsx)(n.h2,{id:"bridging-ai-agents-to-ros-controllers-with-rclpy",children:"Bridging AI Agents to ROS Controllers with rclpy"}),"\n",(0,s.jsx)(n.h3,{id:"integrating-ai-models-with-ros-2",children:"Integrating AI Models with ROS 2"}),"\n",(0,s.jsx)(n.p,{children:"One of the most powerful aspects of ROS 2 is its ability to integrate AI agents with physical robot controllers:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# ai_bridge_node.py\nimport rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String\nfrom geometry_msgs.msg import Twist\nimport tensorflow as tf  # Example AI framework\nimport numpy as np\n\nclass AIBridgeNode(Node):\n    def __init__(self):\n        super().__init__('ai_bridge_node')\n        \n        # Initialize AI model\n        self.ai_model = self.load_ai_model()\n        \n        # Create subscribers and publishers\n        self.sensor_sub = self.create_subscription(\n            String,\n            'sensor_data',\n            self.sensor_callback,\n            10\n        )\n        \n        self.cmd_pub = self.create_publisher(\n            Twist,\n            'cmd_vel',\n            10\n        )\n        \n        self.get_logger().info('AI Bridge Node initialized')\n\n    def load_ai_model(self):\n        # Load your AI model here\n        # This could be a neural network, decision tree, etc.\n        self.get_logger().info('AI model loaded')\n        return \"dummy_model\"  # Replace with actual model\n\n    def sensor_callback(self, msg):\n        # Process sensor data through AI model\n        sensor_data = msg.data\n        ai_decision = self.make_ai_decision(sensor_data)\n        \n        # Convert AI decision to robot command\n        cmd = self.convert_to_command(ai_decision)\n        self.cmd_pub.publish(cmd)\n\n    def make_ai_decision(self, sensor_data):\n        # Use your AI model to make a decision\n        # This is where AI magic happens\n        self.get_logger().info(f'Making decision based on: {sensor_data}')\n        return \"forward\"  # Replace with actual decision\n\n    def convert_to_command(self, decision):\n        cmd = Twist()\n        if decision == \"forward\":\n            cmd.linear.x = 0.5\n        elif decision == \"turn_left\":\n            cmd.angular.z = 0.5\n        elif decision == \"turn_right\":\n            cmd.angular.z = -0.5\n        return cmd\n\ndef main(args=None):\n    rclpy.init(args=args)\n    ai_bridge = AIBridgeNode()\n    rclpy.spin(ai_bridge)\n    ai_bridge.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,s.jsx)(n.h2,{id:"understanding-urdf-unified-robot-description-format",children:"Understanding URDF (Unified Robot Description Format)"}),"\n",(0,s.jsx)(n.p,{children:"URDF is a XML format for representing robot models in ROS:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0"?>\n<robot name="simple_humanoid">\n  \x3c!-- Base Link --\x3e\n  <link name="base_link">\n    <visual>\n      <geometry>\n        <box size="0.5 0.3 0.2"/>\n      </geometry>\n      <material name="blue">\n        <color rgba="0 0 1 1"/>\n      </material>\n    </visual>\n    <collision>\n      <geometry>\n        <box size="0.5 0.3 0.2"/>\n      </geometry>\n    </collision>\n    <inertial>\n      <mass value="1.0"/>\n      <inertia ixx="1.0" ixy="0.0" ixz="0.0" iyy="1.0" iyz="0.0" izz="1.0"/>\n    </inertial>\n  </link>\n\n  \x3c!-- Head --\x3e\n  <link name="head">\n    <visual>\n      <geometry>\n        <sphere radius="0.1"/>\n      </geometry>\n      <material name="white">\n        <color rgba="1 1 1 1"/>\n      </material>\n    </visual>\n  </link>\n\n  <joint name="neck_joint" type="fixed">\n    <parent link="base_link"/>\n    <child link="head"/>\n    <origin xyz="0 0 0.3"/>\n  </joint>\n\n  \x3c!-- Left Arm --\x3e\n  <link name="left_upper_arm">\n    <visual>\n      <geometry>\n        <cylinder length="0.3" radius="0.05"/>\n      </geometry>\n      <material name="red">\n        <color rgba="1 0 0 1"/>\n      </material>\n    </visual>\n  </link>\n\n  <joint name="left_shoulder_joint" type="revolute">\n    <parent link="base_link"/>\n    <child link="left_upper_arm"/>\n    <origin xyz="0.3 0 0.1"/>\n    <axis xyz="0 1 0"/>\n    <limit lower="-1.57" upper="1.57" effort="100" velocity="1"/>\n  </joint>\n  \n  \x3c!-- More links and joints would follow for a complete humanoid model --\x3e\n</robot>\n'})}),"\n",(0,s.jsx)(n.h2,{id:"quality-of-service-qos-profiles",children:"Quality of Service (QoS) Profiles"}),"\n",(0,s.jsx)(n.p,{children:"QoS profiles allow fine-tuning of communication parameters:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from rclpy.qos import QoSProfile, ReliabilityPolicy, DurabilityPolicy\n\n# Reliability: Best effort vs Reliable\nqos_profile_best_effort = QoSProfile(\n    depth=10,\n    reliability=ReliabilityPolicy.BEST_EFFORT\n)\n\nqos_profile_reliable = QoSProfile(\n    depth=10,\n    reliability=ReliabilityPolicy.RELIABLE\n)\n\n# Example usage\nself.image_sub = self.create_subscription(\n    Image,\n    'camera/image_raw',\n    self.image_callback,\n    qos_profile=qos_profile_best_effort\n)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"visualization-and-debugging-tools",children:"Visualization and Debugging Tools"}),"\n",(0,s.jsx)(n.h3,{id:"rviz2",children:"RViz2"}),"\n",(0,s.jsx)(n.p,{children:"RViz2 is the 3D visualization tool for ROS 2:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Visualizing robot models, sensor data, and trajectories"}),"\n",(0,s.jsx)(n.li,{children:"Interactive markers for controlling robots"}),"\n",(0,s.jsx)(n.li,{children:"Plugin architecture for custom displays"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"rqt",children:"rqt"}),"\n",(0,s.jsx)(n.p,{children:"rqt provides GUI tools for monitoring and controlling ROS 2 systems:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"rqt_graph: Visualize node connections"}),"\n",(0,s.jsx)(n.li,{children:"rqt_plot: Plot numerical values over time"}),"\n",(0,s.jsx)(n.li,{children:"rqt_console: Monitor log messages"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"security-in-ros-2",children:"Security in ROS 2"}),"\n",(0,s.jsx)(n.p,{children:"ROS 2 includes enhanced security features:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Authentication"}),": Verify node identity"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Authorization"}),": Control what nodes can communicate"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Encryption"}),": Secure data transmission"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Secure Communication"}),": TLS/SSL support"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"best-practices-for-ros-2-development",children:"Best Practices for ROS 2 Development"}),"\n",(0,s.jsx)(n.h3,{id:"1-node-design",children:"1. Node Design"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Keep nodes focused on single responsibilities"}),"\n",(0,s.jsx)(n.li,{children:"Use composition for complex systems"}),"\n",(0,s.jsx)(n.li,{children:"Implement proper error handling"}),"\n",(0,s.jsx)(n.li,{children:"Include meaningful logging"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"2-message-design",children:"2. Message Design"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Design efficient message structures"}),"\n",(0,s.jsx)(n.li,{children:"Consider bandwidth limitations"}),"\n",(0,s.jsx)(n.li,{children:"Use appropriate data types"}),"\n",(0,s.jsx)(n.li,{children:"Document message semantics"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"3-performance-optimization",children:"3. Performance Optimization"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Use appropriate QoS settings"}),"\n",(0,s.jsx)(n.li,{children:"Minimize message size when possible"}),"\n",(0,s.jsx)(n.li,{children:"Implement efficient algorithms"}),"\n",(0,s.jsx)(n.li,{children:"Profile and optimize critical paths"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"ROS 2 Architecture: Key Components\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    Publish/Subscribe    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Perception    \u2502 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2502   Navigation    \u2502\n\u2502     Node        \u2502                           \u2502     Node        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n        \u2502                                               \u2502\n        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                         \u25bc                    \u25bc\n                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                    \u2502     ROS 2 Communication   \u2502\n                    \u2502       Middleware (DDS)      \u2502\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502\n            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n            \u25bc                 \u25bc                 \u25bc\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502    Control      \u2502 \u2502    Hardware     \u2502 \u2502   Monitoring    \u2502\n    \u2502     Node        \u2502 \u2502   Interface     \u2502 \u2502     Node        \u2502\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(n.h2,{id:"chapter-summary",children:"Chapter Summary"}),"\n",(0,s.jsx)(n.p,{children:"ROS 2 serves as the nervous system of modern robotic platforms, providing essential communication infrastructure that enables complex Physical AI systems. Through its publish/subscribe model, services, and actions, ROS 2 allows for seamless integration of perception, planning, and control systems. The framework's support for multiple programming languages, distributed computing, and real-time constraints makes it ideal for Physical AI applications. Understanding ROS 2 fundamentals is crucial for developing sophisticated humanoid robots that require reliable, real-time communication between diverse components."}),"\n",(0,s.jsx)(n.h2,{id:"key-terms",children:"Key Terms"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"ROS 2"}),": Robot Operating System version 2, providing middleware for robot communication"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Node"}),": Individual process in ROS 2 that performs specific computations"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Topic"}),": Asynchronous publish/subscribe communication mechanism"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Service"}),": Synchronous request/response communication mechanism"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Action"}),": Asynchronous goal-oriented communication with feedback"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"URDF"}),": Unified Robot Description Format, XML format for robot models"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"rclpy"}),": Python client library for ROS 2"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Quality of Service (QoS)"}),": Profiles that define communication reliability and performance"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Launch Files"}),": Configuration files for starting multiple nodes at once"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Parameters"}),": Configuration values that can be set at runtime"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"practice-questions",children:"Practice Questions"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Node Design"}),": Design a ROS 2 node that implements a simple obstacle avoidance behavior. The node should subscribe to laser scan data and publish velocity commands to avoid obstacles. Include error handling and proper logging."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"System Architecture"}),": For a humanoid robot capable of walking, identify the minimum set of ROS 2 nodes required. Describe what each node would do and how they would communicate with each other."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Quality of Service"}),": Explain why different QoS profiles might be appropriate for different types of sensor data (e.g., camera images vs. IMU data vs. joint states). Provide specific examples."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"URDF Modeling"}),": Create a simplified URDF model for a basic wheeled robot with two motors and a camera. Include visual, collision, and inertial properties."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Integration Challenge"}),": Describe how you would integrate a deep learning model (e.g., a neural network for object detection) with ROS 2 nodes. What are the key considerations for real-time performance?"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"reflection-questions",children:"Reflection Questions"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"How does ROS 2's decoupled architecture enable more robust robotic systems compared to monolithic control systems?"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"What are the trade-offs between using services vs. topics for different types of robot communication needs?"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"How might the reliability requirements differ for various robotic applications (e.g., warehouse robots vs. surgical robots)?"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.em,{children:["Continue to ",(0,s.jsx)(n.a,{href:"/docs/chapter-3/digital-twin-simulation",children:"Chapter 3: The Digital Twin (Gazebo & Unity)"})]})})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(u,{...e})}):u(e)}},3113:(e,n,i)=>{i.d(n,{A:()=>o});var r=i(6540),s=i(4746),t=i(4848);const o=({chapterId:e,userId:n="demo-user"})=>{const[i,o]=(0,r.useState)(!1),[l,a]=(0,r.useState)(!1),[c,d]=(0,r.useState)("ur"),[h,u]=(0,r.useState)(""),[p,m]=(0,r.useState)(0),[g,f]=(0,r.useState)(""),[x,b]=(0,r.useState)(null),y=(0,r.useRef)(null),_=(0,r.useRef)(null);(0,r.useEffect)(()=>{if("undefined"==typeof window)return;const e=()=>{const e=[".theme-doc-markdown",".markdown","article","main .container",'[class*="docItemContainer"]'];for(const n of e){const e=document.querySelector(n);if(e&&e.textContent&&e.textContent.length>50)return void(y.current=e)}};e();const n=new MutationObserver(()=>{y.current||e()}),i=document.querySelector("body");return i&&n.observe(i,{childList:!0,subtree:!0}),()=>{n.disconnect(),_.current&&_.current.abort()}},[e]);const j=()=>{const e=y.current;e&&h&&(e.style.transition="opacity 0.3s ease-in-out",e.style.opacity="0",setTimeout(()=>{e.innerHTML=h,e.style.direction="ltr",e.style.textAlign="left",e.style.opacity="1",a(!1),b(null)},300))};return(0,t.jsx)("div",{style:{margin:"2rem auto",padding:"1.5rem",border:"2px solid #e5e7eb",borderRadius:"12px",backgroundColor:"linear-gradient(-45deg,  #ff0055,  #7000ff,  #009c98, #000000)",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",textAlign:"center",maxWidth:"700px",fontFamily:"system-ui, sans-serif"},children:(0,t.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1rem"},children:[(0,t.jsxs)("div",{style:{display:"flex",gap:"10px",alignItems:"center",flexWrap:"wrap",justifyContent:"center"},children:[(0,t.jsxs)("select",{value:c,onChange:e=>{d(e.target.value),l&&j()},disabled:i,style:{padding:"8px",borderRadius:"5px",border:"1px solid #ccc"},children:[(0,t.jsx)("option",{value:"ur",children:"\ud83c\uddf5\ud83c\uddf0 \u0627\u0631\u062f\u0648 (Urdu)"}),(0,t.jsx)("option",{value:"ar",children:"\ud83c\uddf8\ud83c\udde6 \u0627\u0644\u0639\u0631\u0628\u064a\u0629 (Arabic)"}),(0,t.jsx)("option",{value:"es",children:"\ud83c\uddea\ud83c\uddf8 Espa\xf1ol (Spanish)"}),(0,t.jsx)("option",{value:"fr",children:"\ud83c\uddeb\ud83c\uddf7 Fran\xe7ais (French)"})]}),(0,t.jsx)("button",{onClick:async()=>{if(l)return void j();const e=y.current;if(e){o(!0),b(null),m(0),f("Preparing content..."),h||u(e.innerHTML);try{const i=(e=>{const n=3500,i=[];if(e.children.length>0){let r="";Array.from(e.children).forEach(e=>{const s=e.outerHTML;r.length+s.length>n&&r.length>0&&(i.push(r),r=""),r+=s}),r&&i.push(r)}else{const r=e.innerHTML;for(let e=0;e<r.length;e+=n)i.push(r.substring(e,e+n))}return i})(e);if(console.log(`Total chunks to translate: ${i.length}`),0===i.length)throw new Error("No content to translate");let r="";_.current&&_.current.abort(),_.current=new AbortController;for(let e=0;e<i.length;e++){const t=i[e],o=Math.round(e/i.length*100);m(o),f(`Translating part ${e+1} of ${i.length}...`);try{const e=await s.u.post("/api/v1/translate",{text:t,target_language:c,source_language:"en",preserve_formatting:!0});r+=e.translated_text,await new Promise(e=>setTimeout(e,200))}catch(n){console.error(`Error in chunk ${e}:`,n),r+=t}}m(100),f("Finalizing..."),setTimeout(()=>{e&&(e.style.opacity="0",setTimeout(()=>{const n="ur"===c||"ar"===c;e.innerHTML='\n              <div class="alert alert--success margin-bottom--md" style="direction: ltr; text-align: left; padding: 10px; border: 1px solid green; border-radius: 8px; margin-bottom: 20px;">\n                <strong>\u2705 Translated successfully</strong>\n              </div>\n            '+r,e.style.direction=n?"rtl":"ltr",e.style.textAlign=n?"right":"left",e.style.opacity="1"},300)),a(!0),o(!1),f("")},500)}catch(i){console.error("Translation Error:",i),b("Translation failed. Please try again later."),o(!1),m(0)}}else b("Content not found.")},disabled:i,style:{padding:"10px 20px",backgroundColor:l?"#10b981":"#4f46e5",color:"white",border:"none",borderRadius:"6px",cursor:i?"not-allowed":"pointer",fontWeight:"bold",opacity:i?.7:1},children:i?"Translating...":l?"Restore Original":"Translate Page"})]}),i&&(0,t.jsxs)("div",{style:{width:"100%",marginTop:"10px"},children:[(0,t.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.8rem",marginBottom:"5px"},children:[(0,t.jsx)("span",{children:g}),(0,t.jsxs)("span",{children:[p,"%"]})]}),(0,t.jsx)("div",{style:{width:"100%",height:"8px",backgroundColor:"#eee",borderRadius:"4px",overflow:"hidden"},children:(0,t.jsx)("div",{style:{width:`${p}%`,height:"100%",backgroundColor:"#4f46e5",transition:"width 0.3s ease"}})})]}),x&&(0,t.jsxs)("p",{style:{color:"red",marginTop:"10px",fontSize:"0.9rem"},children:["\u26a0\ufe0f ",x]})]})})}},7561:(e,n,i)=>{i.d(n,{A:()=>o});var r=i(6540),s=i(4746),t=i(4848);const o=({chapterId:e,userId:n="1"})=>{const[i,o]=(0,r.useState)(!1),[l,a]=(0,r.useState)(!1),[c,d]=(0,r.useState)(""),[h,u]=(0,r.useState)(0),[p,m]=(0,r.useState)(""),[g,f]=(0,r.useState)(null),[x,b]=(0,r.useState)("intermediate"),y=(0,r.useRef)(null),_=(0,r.useRef)(null);(0,r.useEffect)(()=>{if("undefined"==typeof window)return;const e=()=>{const e=[".theme-doc-markdown","article",".markdown","main .container",'[class*="docItemContainer"]'];for(const n of e){const e=document.querySelector(n);if(e&&e.textContent&&e.textContent.length>50)return void(y.current=e)}};e();const n=new MutationObserver(()=>{y.current||e()}),i=document.querySelector("body");return i&&n.observe(i,{childList:!0,subtree:!0}),()=>{n.disconnect(),_.current&&_.current.abort()}},[e]);const j=()=>{const e=y.current;e&&c&&(e.style.transition="opacity 0.3s ease-in-out",e.style.opacity="0",setTimeout(()=>{e.innerHTML=c,e.style.opacity="1",a(!1),f(null)},300))},v=()=>{switch(x){case"beginner":return"#10b981";case"advanced":return"#8b5cf6";default:return"#3b82f6"}},w=()=>{switch(x){case"beginner":return"\ud83c\udf31";case"advanced":return"\ud83d\ude80";default:return"\ud83d\udcd6"}};return(0,t.jsxs)("div",{className:"custom-button-container",style:{margin:"1.5rem auto",padding:"1.5rem",border:"2px solid #e5e7eb",borderRadius:"16px",backgroundColor:"linear-gradient(-45deg,  #ff0055,  #7000ff,  #009c98, #000000)",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",textAlign:"center",maxWidth:"700px",fontFamily:"system-ui, sans-serif"},children:[(0,t.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1rem"},children:[(0,t.jsxs)("div",{style:{display:"flex",gap:"1rem",alignItems:"center",flexWrap:"wrap",justifyContent:"center"},children:[(0,t.jsx)("label",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#374151"},children:"Target Level:"}),(0,t.jsxs)("select",{value:x,onChange:e=>{b(e.target.value),l&&j()},disabled:i,style:{padding:"0.6rem 1rem",borderRadius:"8px",border:"2px solid "+(i?"#e5e7eb":"#d1d5db"),outline:"none",cursor:i?"not-allowed":"pointer"},children:[(0,t.jsx)("option",{value:"beginner",children:"\ud83c\udf31 Beginner (Simple)"}),(0,t.jsx)("option",{value:"intermediate",children:"\ud83d\udcd6 Intermediate (Standard)"}),(0,t.jsx)("option",{value:"advanced",children:"\ud83d\ude80 Advanced (Technical)"})]})]}),(0,t.jsx)("button",{onClick:async()=>{if(l)return void j();const i=y.current;if(i){o(!0),f(null),u(0),m(`Preparing to personalize for ${x}...`),c||d(i.innerHTML);try{const t=(e=>{const n=3e3,i=[];if(e.children.length>0){let r="";Array.from(e.children).forEach(e=>{const s=e.outerHTML;r.length+s.length>n&&r.length>0&&(i.push(r),r=""),r+=s}),r&&i.push(r)}else{const r=e.innerHTML;for(let e=0;e<r.length;e+=n)i.push(r.substring(e,e+n))}return i})(i);if(console.log(`Personalizing in ${t.length} chunks`),0===t.length)throw new Error("Page content is empty");let l="";_.current&&_.current.abort(),_.current=new AbortController;for(let i=0;i<t.length;i++){const o=t[i],a=Math.round(i/t.length*100);u(a),m(`Adapting section ${i+1} of ${t.length}...`);try{const i=await s.u.post("/api/v1/personalize",{content:o,user_id:n?parseInt(n):1,learning_level:x,chapter_context:e,content_type:"partial_chapter"});l+=i.personalized_content,await new Promise(e=>setTimeout(e,150))}catch(r){console.error(`Error in chunk ${i}:`,r),l+=o}}u(100),m("Finalizing changes..."),setTimeout(()=>{i&&(i.style.transition="opacity 0.3s ease-in-out",i.style.opacity="0",setTimeout(()=>{const e=`\n              <div class="alert alert--success margin-bottom--md" style="padding: 1rem; border-radius: 8px; background-color: ${v()}20; border: 1px solid ${v()}; margin-bottom: 20px;">\n                <strong>${w()} Content Adapted: ${x.charAt(0).toUpperCase()+x.slice(1)} Level</strong>\n                <div style="font-size: 0.85em; margin-top: 5px;">Content has been simplified and examples adjusted for your level.</div>\n              </div>\n            `;i.innerHTML=e+l,i.style.opacity="1"},300)),a(!0),o(!1),m("")},500)}catch(g){console.error("Personalization Error:",g);const n=g.response?.data?.detail||g.message||"Process failed";f(`Failed: ${n}`),o(!1),u(0)}}else f("Content to personalize not found.")},disabled:i,style:{padding:"1rem 2rem",backgroundColor:l?"#059669":v(),color:"white",border:"none",borderRadius:"12px",cursor:i?"wait":"pointer",fontWeight:"700",fontSize:"1.05rem",display:"flex",alignItems:"center",gap:"0.75rem",transition:"all 0.2s",opacity:i?.8:1,boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:i?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{style:{width:"18px",height:"18px",border:"3px solid rgba(255,255,255,0.3)",borderTop:"3px solid white",borderRadius:"50%",animation:"spin 1s linear infinite",display:"inline-block"}}),(0,t.jsx)("span",{children:"Processing..."})]}):l?(0,t.jsx)(t.Fragment,{children:"\u21a9\ufe0f Restore Original"}):(0,t.jsx)(t.Fragment,{children:"\u2728 Personalize Content"})}),i&&(0,t.jsxs)("div",{style:{width:"100%",marginTop:"0.5rem"},children:[(0,t.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:[(0,t.jsx)("span",{children:p}),(0,t.jsxs)("span",{children:[h,"%"]})]}),(0,t.jsx)("div",{style:{width:"100%",height:"6px",backgroundColor:"#e5e7eb",borderRadius:"3px",overflow:"hidden"},children:(0,t.jsx)("div",{style:{width:`${h}%`,height:"100%",backgroundColor:v(),transition:"width 0.3s ease"}})})]}),!i&&(0,t.jsx)("p",{style:{margin:0,fontSize:"0.9rem",color:g?"#dc2626":"#6b7280",marginTop:"0.5rem"},children:g?`\u26a0\ufe0f ${g}`:l?"\u2705 Content updated based on your preferences.":"AI will rewrite the content to match your selected difficulty level."})]}),(0,t.jsx)("style",{children:"\n        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }\n      "})]})}},8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>l});var r=i(6540);const s={},t=r.createContext(s);function o(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(t.Provider,{value:n},e.children)}},9815:(e,n,i)=>{i(6540),i(9345),i(4848)}}]);